Debounceï¼ˆé˜²æŠ–ï¼‰ å’Œ throttleï¼ˆæˆªæµï¼‰ æ˜¯æˆ‘ä»¬åœ¨ JavaScript ä¸­ä½¿ç”¨çš„ä¸¤ä¸ªæ¦‚å¿µï¼Œç”¨äºå¢å¼ºå¯¹å‡½æ•°æ‰§è¡Œçš„æ§åˆ¶ï¼Œè¿™åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚è¿™ä¸¤ç§æŠ€æœ¯éƒ½å›ç­”äº†åŒä¸€ä¸ªé—®é¢˜  â€œä¸€æ®µæ—¶é—´å†…æŸä¸ªå‡½æ•°çš„è°ƒç”¨é¢‘ç‡æ˜¯å¤šå°‘ï¼Ÿâ€

## ğŸ“š Debounce

### 1. æ¦‚å¿µ

- æœ¬æ˜¯æœºæ¢°å¼€å…³çš„â€œå»å¼¹è·³â€æ¦‚å¿µï¼Œå¼¹ç°§å¼€å…³æŒ‰ä¸‹åï¼Œç”±äºç°§ç‰‡çš„ä½œç”¨ï¼Œæ¥è§¦ç‚¹ä¼šè¿ç»­æ¥è§¦æ–­å¼€å¥½å¤šæ¬¡ï¼Œå¦‚æœæ¯æ¬¡æ¥è§¦éƒ½é€šç”µå¯¹ç”¨ç”µå™¨ä¸å¥½ï¼Œæ‰€ä»¥å°±è¦æ§åˆ¶æŒ‰ä¸‹åˆ°ç¨³å®šçš„è¿™æ®µæ—¶é—´ä¸é€šç”µ
- å‰ç«¯å¼€å‘ä¸­åˆ™æ˜¯ä¸€äº›é¢‘ç¹çš„äº‹ä»¶è§¦å‘
  - é¼ æ ‡ï¼ˆ`mousemove`...ï¼‰é”®ç›˜ï¼ˆ`keydown`...ï¼‰äº‹ä»¶ç­‰
  - è¡¨å•çš„å®æ—¶æ ¡éªŒï¼ˆé¢‘ç¹å‘é€éªŒè¯è¯·æ±‚ï¼‰
- åœ¨ debounce å‡½æ•°æ²¡æœ‰å†è¢«è°ƒç”¨çš„æƒ…å†µä¸‹ç»è¿‡ delay æ¯«ç§’åæ‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¾‹å¦‚
  - åœ¨`mousemove`äº‹ä»¶ä¸­ï¼Œç¡®ä¿å¤šæ¬¡è§¦å‘åªè°ƒç”¨ä¸€æ¬¡ç›‘å¬å‡½æ•°
  - åœ¨è¡¨å•æ ¡éªŒçš„æ—¶å€™ï¼Œä¸åŠ é˜²æŠ–ï¼Œä¾æ¬¡è¾“å…¥`user`ï¼Œå°±ä¼šåˆ†æˆ`u`ï¼Œ`us`ï¼Œ`use`,`user`å››æ¬¡å‘å‡ºè¯·æ±‚ï¼›è€Œæ·»åŠ é˜²æŠ–ï¼Œè®¾ç½®å¥½æ—¶é—´ï¼Œå¯ä»¥å®ç°å®Œæ•´è¾“å…¥`user`æ‰å‘å‡ºæ ¡éªŒè¯·æ±‚

### 2. æ€è·¯

- ç”± debounce çš„åŠŸèƒ½å¯çŸ¥é˜²æŠ–å‡½æ•°è‡³å°‘æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆæµè¡Œç±»åº“ä¸­éƒ½æ˜¯ 3 ä¸ªå‚æ•°ï¼‰
  - å›è°ƒå‡½æ•°`fn`
  - å»¶æ—¶æ—¶é—´`delay`
- debounce å‡½æ•°**è¿”å›ä¸€ä¸ªé—­åŒ…**ï¼Œé—­åŒ…è¢«é¢‘ç¹çš„è°ƒç”¨
  - debounce å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹åè°ƒç”¨çš„éƒ½æ˜¯å®ƒè¿”å›çš„é—­åŒ…å‡½æ•°
  - åœ¨é—­åŒ…å†…éƒ¨é™åˆ¶äº†å›è°ƒå‡½æ•°`fn`çš„æ‰§è¡Œï¼Œå¼ºåˆ¶åªæœ‰è¿ç»­æ“ä½œåœæ­¢åæ‰§è¡Œä¸€æ¬¡
- ä½¿ç”¨é—­åŒ…æ˜¯ä¸ºäº†ä½¿æŒ‡å‘å®šæ—¶å™¨çš„å˜é‡ä¸è¢«`gc`å›æ”¶
  - å®ç°åœ¨å»¶æ—¶æ—¶é—´`delay`å†…çš„è¿ç»­è§¦å‘éƒ½ä¸æ‰§è¡Œå›è°ƒå‡½æ•°`fn`ï¼Œä½¿ç”¨çš„æ˜¯åœ¨é—­åŒ…å†…è®¾ç½®å®šæ—¶å™¨`setTimeOut`
  - é¢‘ç¹è°ƒç”¨è¿™ä¸ªé—­åŒ…ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨æ—¶éƒ½è¦å°†ä¸Šæ¬¡è°ƒç”¨çš„å®šæ—¶å™¨æ¸…é™¤
  - è¢«é—­åŒ…ä¿å­˜çš„å˜é‡å°±æ˜¯æŒ‡å‘ä¸Šä¸€æ¬¡è®¾ç½®çš„å®šæ—¶å™¨

### 3. å®ç°

- ç¬¦åˆåŸç†çš„ç®€å•å®ç°

  ```js
  function debounce(fn, delay) {
    var timer;
    return function() {
      // æ¸…é™¤ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶è®¾ç½®çš„å®šæ—¶å™¨
      // è®¡æ—¶å™¨æ¸…é›¶
      clearTimeout(timer);
      // é‡æ–°è®¾ç½®è®¡æ—¶å™¨
      timer = setTimeout(fn, delay);
    };
  }
  
  ```

- ç®€å•å®ç°çš„ä»£ç ï¼Œå¯èƒ½ä¼šé€ æˆä¸¤ä¸ªé—®é¢˜

  - `this`æŒ‡å‘é—®é¢˜ã€‚debounce å‡½æ•°åœ¨å®šæ—¶å™¨ä¸­è°ƒç”¨å›è°ƒå‡½æ•°`fn`ï¼Œæ‰€ä»¥`fn`æ‰§è¡Œçš„æ—¶å€™`this`æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­`window`ï¼‰ï¼Œéœ€è¦åœ¨å¤–å±‚ç”¨å˜é‡å°†`this`ä¿å­˜ä¸‹æ¥ï¼Œä½¿ç”¨`apply`è¿›è¡Œæ˜¾å¼ç»‘å®š

    ```js
    function debounce(fn, delay) {
      var timer;
      return function() {
        // ä¿å­˜è°ƒç”¨æ—¶çš„this
        var context = this;
        clearTimeout(timer);
        timer = setTimeout(function() {
          // ä¿®æ­£ this çš„æŒ‡å‘
          fn.apply(context);
        }, delay);
      };
    }
    
    ```

  - `event`å¯¹è±¡ã€‚JavaScript çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ä¼šæä¾›äº‹ä»¶å¯¹è±¡`event`ï¼Œåœ¨é—­åŒ…ä¸­è°ƒç”¨æ—¶éœ€è¦å°†è¿™ä¸ªäº‹ä»¶å¯¹è±¡ä¼ å…¥

    ```js
    function debounce(fn, delay) {
      var timer;
      return function() {
        // ä¿å­˜è°ƒç”¨æ—¶çš„this
        var context = this;
        // ä¿å­˜å‚æ•°
        var args = arguments;
        clearTimeout(timer);
        timer = setTimeout(function() {
          console.log(context);
          // ä¿®æ­£thisï¼Œå¹¶ä¼ å…¥å‚æ•°
          fn.apply(context, args);
        }, delay);
      };
    }
    
    ```

### 4. å®Œå–„ï¼ˆ`underscore`çš„å®ç°ï¼‰

- ç«‹åˆ»æ‰§è¡Œã€‚å¢åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸¤ç§æƒ…å†µ

  - å…ˆæ‰§è¡Œå›è°ƒå‡½æ•°`fn`ï¼Œç­‰åˆ°åœæ­¢è§¦å‘åçš„`delay`æ¯«ç§’ï¼Œæ‰å¯ä»¥å†æ¬¡è§¦å‘ï¼ˆ**å…ˆæ‰§è¡Œ**ï¼‰
  - è¿ç»­çš„è°ƒç”¨ debounce å‡½æ•°ä¸è§¦å‘å›è°ƒå‡½æ•°ï¼Œåœæ­¢è°ƒç”¨ç»è¿‡`delay`æ¯«ç§’åæ‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼ˆ**åæ‰§è¡Œ**ï¼‰
  - `clearTimeout(timer)`åï¼Œ`timer`å¹¶ä¸ä¼šå˜æˆ`null`ï¼Œè€Œæ˜¯ä¾ç„¶æŒ‡å‘å®šæ—¶å™¨å¯¹è±¡

  ```js
  function debounce(fn, delay, immediate) {
    var timer;
    return function() {
      var context = this;
      var args = arguments;
      // åœæ­¢å®šæ—¶å™¨
      if (timer) clearTimeout(timer);
      // å›è°ƒå‡½æ•°æ‰§è¡Œçš„æ—¶æœº
      if (immediate) {
        // æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡
        // æ‰§è¡Œè¿‡ï¼Œåˆ™timeræŒ‡å‘å®šæ—¶å™¨å¯¹è±¡ï¼ŒcallNow ä¸º false
        // æœªæ‰§è¡Œï¼Œåˆ™timer ä¸º nullï¼ŒcallNow ä¸º true
        var callNow = !timer;
        // è®¾ç½®å»¶æ—¶
        timer = setTimeout(function() {
          timer = null;
        }, delay);
        if (callNow) fn.apply(context, args);
      } else {
        // åœæ­¢è°ƒç”¨ådelayæ—¶é—´æ‰æ‰§è¡Œå›è°ƒå‡½æ•°
        timer = setTimeout(function() {
          fn.apply(context, args);
        }, delay);
      }
    };
  }
  
  ```

- è¿”å›å€¼ä¸å–æ¶ˆ debounce å‡½æ•°

  - å›è°ƒå‡½æ•°å¯èƒ½æœ‰è¿”å›å€¼ã€‚
    - åæ‰§è¡Œæƒ…å†µå¯ä»¥ä¸è€ƒè™‘è¿”å›å€¼ï¼Œå› ä¸ºåœ¨æ‰§è¡Œå›è°ƒå‡½æ•°å‰çš„è¿™æ®µæ—¶é—´é‡Œï¼Œè¿”å›å€¼ä¸€ç›´æ˜¯`undefined`
    - å…ˆæ‰§è¡Œæƒ…å†µï¼Œä¼šå…ˆå¾—åˆ°è¿”å›å€¼
  - èƒ½å–æ¶ˆ debounce å‡½æ•°ã€‚ä¸€èˆ¬å½“`immediate`ä¸º`true`çš„æ—¶å€™ï¼Œè§¦å‘ä¸€æ¬¡åè¦ç­‰å¾…`delay`æ—¶é—´åæ‰èƒ½å†æ¬¡è§¦å‘ï¼Œä½†æ˜¯æƒ³è¦åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…æƒ³è¦å†æ¬¡è§¦å‘ï¼Œå¯ä»¥å…ˆå–æ¶ˆæ‰ä¹‹å‰çš„ debounce å‡½æ•°

  ```js
  function debounce(fn, delay, immediate) {
    var timer, result;
    var debounced = function() {
      var context = this;
      var args = arguments;
      // åœæ­¢å®šæ—¶å™¨
      if (timer) clearTimeout(timer);
      // å›è°ƒå‡½æ•°æ‰§è¡Œçš„æ—¶æœº
      if (immediate) {
        // æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡
        // æ‰§è¡Œè¿‡ï¼Œåˆ™timeræŒ‡å‘å®šæ—¶å™¨å¯¹è±¡ï¼ŒcallNow ä¸º false
        // æœªæ‰§è¡Œï¼Œåˆ™timer ä¸º nullï¼ŒcallNow ä¸º true
        var callNow = !timer;
        // è®¾ç½®å»¶æ—¶
        timer = setTimeout(function() {
          timer = null;
        }, delay);
        if (callNow) result = fn.apply(context, args);
      } else {
        // åœæ­¢è°ƒç”¨ådelayæ—¶é—´æ‰æ‰§è¡Œå›è°ƒå‡½æ•°
        timer = setTimeout(function() {
          fn.apply(context, args);
        }, delay);
      }
      // è¿”å›å›è°ƒå‡½æ•°çš„è¿”å›å€¼
      return result;
    };
  
    // å–æ¶ˆæ“ä½œ
    debounced.cancel = function() {
      clearTimeout(timer);
      timer = null;
    };
  
    return debounced;
  }
  
  ```

- ES6 å†™æ³•

  ```js
  function debounce(fn, delay, immediate) {
    let timer, result;
    // è¿™é‡Œä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä¸ç„¶ this ä¾ç„¶ä¼šæŒ‡å‘ Windowså¯¹è±¡
    // ä½¿ç”¨restå‚æ•°ï¼Œè·å–å‡½æ•°çš„å¤šä½™å‚æ•°
    const debounced = function(...args) {
      if (timer) clearTimeout(timer);
      if (immediate) {
        const callNow = !timer;
        timer = setTimeout(() => {
          timer = null;
        }, delay);
        if (callNow) result = fn.apply(this, args);
      } else {
        timer = setTimeout(() => {
          fn.apply(this, args);
        }, delay);
      }
      return result;
    };
  
    debounced.cancel = () => {
      clearTimeout(timer);
      timer = null;
    };
  
    return debounced;
  }
  
  ```

## ğŸ“š throttle

### 1. æ¦‚å¿µ

- å›ºå®šå‡½æ•°æ‰§è¡Œçš„é€Ÿç‡
- å¦‚æœæŒç»­è§¦å‘äº‹ä»¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæ‰§è¡Œä¸€æ¬¡äº‹ä»¶
  - ä¾‹å¦‚ç›‘å¬`mousemove`äº‹ä»¶æ—¶ï¼Œä¸ç®¡é¼ æ ‡ç§»åŠ¨çš„é€Ÿåº¦ï¼Œã€èŠ‚æµã€‘åçš„ç›‘å¬å‡½æ•°ä¼šåœ¨ wait ç§’å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä»¥æ­¤ã€åŒ€é€Ÿã€‘è§¦å‘æ‰§è¡Œ
- `window`çš„ `resize`ã€`scroll`äº‹ä»¶çš„ä¼˜åŒ–ç­‰

### 2. æ€è·¯

- æœ‰ä¸¤ç§ä¸»æµå®ç°æ–¹å¼
  - ä½¿ç”¨æ—¶é—´æˆ³
  - è®¾ç½®å®šæ—¶å™¨
- èŠ‚æµå‡½æ•° throttle è°ƒç”¨å**è¿”å›ä¸€ä¸ªé—­åŒ…**
  - é—­åŒ…ç”¨æ¥ä¿å­˜ä¹‹å‰çš„æ—¶é—´æˆ³æˆ–è€…å®šæ—¶å™¨å˜é‡ï¼ˆå› ä¸º**å˜é‡è¢«è¿”å›çš„å‡½æ•°å¼•ç”¨ï¼Œæ‰€ä»¥æ— æ³•è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶**ï¼‰
- æ—¶é—´æˆ³æ–¹å¼
  - å½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œå–å‡ºå½“å‰çš„æ—¶é—´æˆ³ï¼Œç„¶åå‡å»ä¹‹å‰çš„æ—¶é—´æˆ³ï¼ˆåˆå§‹è®¾ç½®ä¸º 0ï¼‰
  - ç»“æœå¤§äºè®¾ç½®çš„æ—¶é—´å‘¨æœŸï¼Œåˆ™æ‰§è¡Œå‡½æ•°ï¼Œç„¶åæ›´æ–°æ—¶é—´æˆ³ä¸ºå½“å‰æ—¶é—´æˆ³
  - ç»“æœå°äºè®¾ç½®çš„æ—¶é—´å‘¨æœŸï¼Œåˆ™ä¸æ‰§è¡Œå‡½æ•°
- å®šæ—¶å™¨æ–¹å¼
  - å½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨
  - å†æ¬¡è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œï¼ŒçŸ¥é“å®šæ—¶å™¨æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå‡½æ•°ï¼Œæ¸…ç©ºå®šæ—¶å™¨
  - è®¾ç½®ä¸‹ä¸ªå®šæ—¶å™¨
- å°†ä¸¤ç§æ–¹å¼ç»“åˆï¼Œå¯ä»¥å®ç°å…¼å¹¶ç«‹åˆ»æ‰§è¡Œå’Œåœæ­¢è§¦å‘åä¾ç„¶æ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœ

### 3. å®ç°

- æ—¶é—´æˆ³å®ç°

  ```js
  function throttle(fn, wait) {
    var args;
    // å‰ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´æˆ³
    var previous = 0;
    return function() {
      // å°†æ—¶é—´è½¬ä¸ºæ—¶é—´æˆ³
      var now = +new Date();
      args = arguments;
      // æ—¶é—´é—´éš”å¤§äºå»¶è¿Ÿæ—¶é—´æ‰æ‰§è¡Œ
      if (now - previous > wait) {
        fn.apply(this, args);
        previous = now;
      }
    };
  }
  
  ```

  - è§¦å‘ç›‘å¬äº‹ä»¶ï¼Œå›è°ƒå‡½æ•°ä¼šç«‹åˆ»æ‰§è¡Œï¼ˆåˆå§‹çš„`previous`ä¸º 0ï¼Œé™¤éè®¾ç½®çš„æ—¶é—´é—´éš”å¤§äºå½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ï¼Œå¦åˆ™å·®å€¼è‚¯å®šå¤§äºæ—¶é—´é—´éš”ï¼‰
  - åœæ­¢è§¦å‘åï¼Œæ— è®ºåœæ­¢æ—¶é—´åœ¨å“ªï¼Œéƒ½ä¸ä¼šå†æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œ1 ç§’æ‰§è¡Œ 1 æ¬¡ï¼Œåœ¨ 4.2 ç§’åœæ­¢ï¼Œåˆ™ç¬¬ 5 ç§’ä¸ä¼šå†æ‰§è¡Œ 1 æ¬¡

- å®šæ—¶å™¨å®ç°

  ```js
  function throttle(fn, wait) {
    var timer, context, args;
    return function() {
      context = this;
      args = arguments;
      // å¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œ
      if (!timer) {
        timer = setTimeout(function() {
          // æ‰§è¡Œåé‡Šæ”¾å®šæ—¶å™¨å˜é‡
          timer = null;
          fn.apply(context, args);
        }, wait);
      }
    };
  }
  
  ```

  - å›è°ƒå‡½æ•°ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè¦åœ¨ wait ç§’åç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œåœæ­¢è§¦å‘é—­åŒ…åï¼Œå¦‚æœåœæ­¢æ—¶é—´åœ¨ä¸¤æ¬¡æ‰§è¡Œä¹‹é—´ï¼Œåˆ™è¿˜ä¼šæ‰§è¡Œä¸€æ¬¡

- ç»“åˆæ—¶é—´æˆ³å’Œå®šæ—¶å™¨å®ç°

  ```js
  function throttle(fn, wait) {
    var timer, context, args;
    var previous = 0;
    // å»¶æ—¶æ‰§è¡Œå‡½æ•°
    var later = function() {
      previous = +new Date();
      // æ‰§è¡Œåé‡Šæ”¾å®šæ—¶å™¨å˜é‡
      timer = null;
      fn.apply(context, args);
      if (!timeout) context = args = null;
    };
    var throttled = function() {
      var now = +new Date();
      // è·ç¦»ä¸‹æ¬¡æ‰§è¡Œ fn çš„æ—¶é—´
      // å¦‚æœäººä¸ºä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼Œå¯èƒ½å‡ºç° now å°äº previous æƒ…å†µ
      // åˆ™å‰©ä½™æ—¶é—´å¯èƒ½è¶…è¿‡æ—¶é—´å‘¨æœŸ wait
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      // æ²¡æœ‰å‰©ä½™æ—¶é—´ || ä¿®æ”¹ç³»ç»Ÿæ—¶é—´å¯¼è‡´æ—¶é—´å¼‚å¸¸ï¼Œåˆ™ä¼šç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°fn
      // åˆæ¬¡è°ƒç”¨æ—¶ï¼Œpreviousä¸º0ï¼Œé™¤éwaitå¤§äºå½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ï¼Œå¦åˆ™å‰©ä½™æ—¶é—´ä¸€å®šå°äº0
      if (remaining <= 0 || remaining > wait) {
        // å¦‚æœå­˜åœ¨å»¶æ—¶æ‰§è¡Œå®šæ—¶å™¨ï¼Œå°†å…¶å–æ¶ˆæ‰
        if (timer) {
          clearTimeout(timer);
          timer = null;
        }
        previous = now;
        fn.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timer) {
        // è®¾ç½®å»¶æ—¶æ‰§è¡Œ
        timer = setTimeout(later, remaining);
      }
    };
    return throttled;
  }
  
  ```

  - è¿‡ç¨‹ä¸­çš„èŠ‚æµåŠŸèƒ½æ˜¯ç”±æ—¶é—´æˆ³çš„åŸç†å®ç°ï¼ŒåŒæ—¶å®ç°äº†ç«‹åˆ»æ‰§è¡Œ
  - å®šæ—¶å™¨åªæ˜¯ç”¨æ¥è®¾ç½®åœ¨æœ€åé€€å‡ºæ—¶å¢åŠ ä¸€ä¸ªå»¶æ—¶æ‰§è¡Œ
  - å®šæ—¶å™¨åœ¨æ¯æ¬¡è§¦å‘æ—¶éƒ½ä¼šé‡æ–°è®¡æ—¶ï¼Œä½†æ˜¯åªè¦ä¸åœæ­¢è§¦å‘ï¼Œå°±ä¸ä¼šå»æ‰§è¡Œå›è°ƒå‡½æ•° fn

### 4. ä¼˜åŒ–å®Œå–„

- å¢åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè®©ç”¨æˆ·å¯ä»¥è‡ªå·±é€‰æ‹©æ¨¡å¼

  - å¿½ç•¥å¼€å§‹è¾¹ç•Œä¸Šçš„è°ƒç”¨ï¼Œä¼ å…¥`{ leading: false }`
  - å¿½ç•¥ç»“å°¾è¾¹ç•Œä¸Šçš„è°ƒç”¨ï¼Œä¼ å…¥`{ trailing: false }`

- å¢åŠ è¿”å›å€¼åŠŸèƒ½

- å¢åŠ å–æ¶ˆåŠŸèƒ½

  ```js
  function throttle(func, wait, options) {
    var context, args, result;
    var timeout = null;
    // ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ç‚¹
    var previous = 0;
    if (!options) options = {};
    // å»¶è¿Ÿæ‰§è¡Œå‡½æ•°
    var later = function() {
      // è‹¥è®¾å®šäº†å¼€å§‹è¾¹ç•Œä¸æ‰§è¡Œé€‰é¡¹ï¼Œä¸Šæ¬¡æ‰§è¡Œæ—¶é—´å§‹ç»ˆä¸º0
      previous = options.leading === false ? 0 : new Date().getTime();
      timeout = null;
      // func å¯èƒ½ä¼šä¿®æ”¹ timeout å˜é‡
      result = func.apply(context, args);
      // å®šæ—¶å™¨å˜é‡å¼•ç”¨ä¸ºç©ºï¼Œè¡¨ç¤ºæœ€åä¸€æ¬¡æ‰§è¡Œï¼Œåˆ™è¦æ¸…é™¤é—­åŒ…å¼•ç”¨çš„å˜é‡
      if (!timeout) context = args = null;
    };
    var throttled = function() {
      var now = new Date().getTime();
      // é¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œå¦‚æœè®¾å®šäº†å¼€å§‹è¾¹ç•Œä¸æ‰§è¡Œé€‰é¡¹ï¼Œå°†ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´è®¾å®šä¸ºå½“å‰æ—¶é—´ã€‚
      if (!previous && options.leading === false) previous = now;
      // å»¶è¿Ÿæ‰§è¡Œæ—¶é—´é—´éš”
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      // å»¶è¿Ÿæ—¶é—´é—´éš”remainingå°äºç­‰äº0ï¼Œè¡¨ç¤ºä¸Šæ¬¡æ‰§è¡Œè‡³æ­¤æ‰€é—´éš”æ—¶é—´å·²ç»è¶…è¿‡ä¸€ä¸ªæ—¶é—´çª—å£
      // remaining å¤§äºæ—¶é—´çª—å£ waitï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯ç³»ç»Ÿæ—¶é—´è¢«è°ƒæ•´è¿‡
      if (remaining <= 0 || remaining > wait) {
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timeout && options.trailing !== false) {
        timeout = setTimeout(later, remaining);
      }
      // è¿”å›å›è°ƒå‡½æ•°æ‰§è¡Œåçš„è¿”å›å€¼
      return result;
    };
    throttled.cancel = function() {
      clearTimeout(timeout);
      previous = 0;
      timeout = context = args = null;
    };
    return throttled;
  }
  
  ```

  - æœ‰ä¸ªé—®é¢˜ï¼Œ

    ```
    leading: false
    ```

     å’Œ 

    ```
    trailing: false
    ```

     ä¸èƒ½åŒæ—¶è®¾ç½®

    - ç¬¬ä¸€æ¬¡å¼€å§‹è¾¹ç•Œä¸æ‰§è¡Œï¼Œä½†æ˜¯ï¼Œç¬¬ä¸€æ¬¡è§¦å‘æ—¶ï¼Œ`previous`ä¸º 0ï¼Œåˆ™`remaining`å€¼å’Œ`wait`ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œ`if (!previous && options.leading === false)`ä¸ºçœŸï¼Œæ”¹å˜äº†`previous`çš„å€¼ï¼Œè€Œ`if (remaining <= 0 || remaining > wait)`ä¸ºå‡
    - ä»¥åå†è§¦å‘å°±ä¼šå¯¼è‡´`if (!previous && options.leading === false)`ä¸ºå‡ï¼Œè€Œ`if (remaining <= 0 || remaining > wait)`ä¸ºçœŸã€‚å°±å˜æˆäº†å¼€å§‹è¾¹ç•Œæ‰§è¡Œã€‚è¿™æ ·å°±å’Œ`leading: false`å†²çªäº†

## ğŸ“š æ€»ç»“

- è‡³æ­¤ï¼Œå®Œæ•´å®ç°äº†ä¸€ä¸ª`underscore`ä¸­çš„ debounce å‡½æ•°å’Œ throttle å‡½æ•°
- è€Œ`lodash`ä¸­ debounce å‡½æ•°å’Œ throttle å‡½æ•°çš„å®ç°æ›´åŠ å¤æ‚ï¼Œå°è£…æ›´åŠ å½»åº•
- æ¨èä¸¤ä¸ªå¯è§†åŒ–æ‰§è¡Œè¿‡ç¨‹çš„å·¥å…·
  - [demo.nimius.net/debounce_thâ€¦](http://demo.nimius.net/debounce_throttle/)
  - [caiogondim.github.io/js-debounceâ€¦](http://caiogondim.github.io/js-debounce-throttle-visual-explanation/)
- è‡ªå·±å®ç°æ˜¯ä¸ºäº†å­¦ä¹ å…¶ä¸­çš„æ€æƒ³ï¼Œå®é™…å¼€å‘ä¸­å°½é‡ä½¿ç”¨ lodash æˆ– underscore è¿™æ ·çš„ç±»åº“ã€‚

### å¯¹æ¯”

- throttle å’Œ debounce æ˜¯è§£å†³è¯·æ±‚å’Œå“åº”é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜çš„ä¸¤ä¸ªæ–¹æ¡ˆã€‚äºŒè€…çš„å·®å¼‚åœ¨äºé€‰æ‹©ä¸åŒçš„ç­–ç•¥
- ç”µæ¢¯è¶…æ—¶ç°è±¡è§£é‡Šä¸¤è€…åŒºåˆ«ã€‚å‡è®¾ç”µæ¢¯è®¾å®šä¸º 15 ç§’ï¼Œä¸è€ƒè™‘å®¹é‡é™åˆ¶
  - `throttle`ç­–ç•¥ï¼šä¿è¯å¦‚æœç”µæ¢¯ç¬¬ 1 ä¸ªäººè¿›æ¥åï¼Œ15 ç§’åå‡†æ—¶é€ä¸€æ¬¡ï¼Œä¸ç­‰å¾…ã€‚å¦‚æœæ²¡æœ‰äººï¼Œåˆ™å¾…æœºã€
  - `debounce`ç­–ç•¥ï¼šå¦‚æœç”µæ¢¯æœ‰äººè¿›æ¥ï¼Œç­‰å¾… 15 ç§’ï¼Œå¦‚æœåˆæœ‰äººè¿›æ¥ï¼Œé‡æ–°è®¡æ—¶ 15 ç§’ï¼Œç›´åˆ° 15 ç§’è¶…æ—¶éƒ½æ²¡æœ‰äººå†è¿›æ¥ï¼Œåˆ™å¼€å§‹è¿é€